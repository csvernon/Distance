<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="./geolib/lib/index.js"></script>

    <script type="text/javascript">
        console.log("ready");
        var oldLat = "";
        var oldLong = "";
        var unit = "M";
        var latitude = "";
        var longitude = "";
        // if (navigator.geolocation) {
        //     navigator.geolocation.getCurrentPosition(function (position) {
        //         var latitude = position.coords.latitude;
        //         var longitude = position.coords.longitude;
        //         var accuracy = position.coords.accuracy;

        //         var capa = document.getElementById("capa");

        //         console.log(latitude);
        //         console.log(longitude);
        //         console.log(accuracy);

        //     },
        //         function error(msg) { alert('Please enable your GPS position feature.'); },
        //         { maximumAge: 10000, timeout: 5000, enableHighAccuracy: true });
        // } else {
        //     alert("Geolocation API is not supported in your browser.");
        // }

        // alert(calcCrow(35.897376, -78.6494807, 35.8973972, -78.6492278).toFixed(1));



        //This function takes in latitude and longitude of two location and returns the distance between them as the crow flies (in km)
        // function calcCrow(lat1, lon1, lat2, lon2) {
        //     var R = 6371; // km
        //     var dLat = toRad(lat2 - lat1);
        //     var dLon = toRad(lon2 - lon1);
        //     var lat1 = toRad(lat1);
        //     var lat2 = toRad(lat2);

        //     var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        //         Math.sin(dLon / 2) * Math.sin(dLon / 2) * Math.cos(lat1) * Math.cos(lat2);
        //     var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        //     var d = R * c;
        //     console.log(d);
        //     alert(toRad(d).toFixed(1));

        //     return d;
        // }
        // // Converts numeric degrees to radians
        // function toRad(value) {
        //     var distance = value * Math.PI / 180;
        //     console.log(distance)

        //     return value * Math.PI / 180;
        // }

        // function distance(lat1, lon1, lat2, lon2, unit) {
        //     {
        //         var radlat1 = Math.PI * lat1 / 180;
        //         var radlat2 = Math.PI * lat2 / 180;
        //         var theta = lon1 - lon2;
        //         var radtheta = Math.PI * theta / 180;
        //         var dist = Math.sin(radlat1) * Math.sin(radlat2) + Math.cos(radlat1) * Math.cos(radlat2) * Math.cos(radtheta);
        //         if (dist > 1) {
        //             dist = 1;
        //         }
        //         dist = Math.acos(dist);
        //         dist = dist * 180 / Math.PI;
        //         dist = dist * 60 * 1.1515;
        //         if (unit == "K") { dist = dist * 1.609344 }
        //         if (unit == "N") { dist = dist * 0.8684 }
        //         var distance = dist;
        //         console.log(distance);
        //         $("#coordsDiv").append("<div>Latitude: " + latitude + " | Longitude: " + longitude + " | Distance: " + distance + "</div>");
        //         return distance;
        //     }
        // }
        $(document).ready(function () {
            $("#recordLoc").hide();
            $("#firstLoc").click(function () {
                event.preventDefault();
                console.log("clicked")
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function (position) {
                        latitude = position.coords.latitude;
                        longitude = position.coords.longitude;
                        var accuracy = position.coords.accuracy;

                        var capa = document.getElementById("capa");
                        console.log(accuracy);
                    },
                        function error(msg) { alert('Please enable your GPS position feature.'); },
                        { maximumAge: 10000, timeout: 5000, enableHighAccuracy: true });

                    //   distance(oldLat, oldLong, latitude, longitude, unit);
                    var distM = geolib.getPreciseDistance(
                        { latitude: oldLat, longitude: oldLong },
                        { latitude: latitude, longitude: longitude }
                    );
                    distance = distM * 2.8;
                    console.log(distance + " feet");
                    $("#coordsDiv").append("Location data set, start moving!");
                    oldLat = latitude;
                    oldLong = longitude;
                    $("#firstLoc").hide();
                    $("#recordLoc").show();
                } else {
                    alert("Geolocation API is not supported in your browser.");
                }
            });

            $("#recordLoc").click(function () {
                event.preventDefault();
                console.log("clicked")
                if (navigator.geolocation) {
                    navigator.geolocation.watchPosition(function (position) {
                        latitude = position.coords.latitude;
                        longitude = position.coords.longitude;
                        var accuracy = position.coords.accuracy;

                        var capa = document.getElementById("capa");

                        console.log(accuracy);

                    },
                        function error(msg) { alert('Please enable your GPS position feature.'); },
                        { maximumAge: 10000, timeout: 5000, enableHighAccuracy: true });

                    var distM = geolib.getPreciseDistance(
                        { latitude: oldLat, longitude: oldLong },
                        { latitude: latitude, longitude: longitude }
                    );
                    distance = distM * 2;
                    console.log(distance + " feet");

                    $("#coordsDiv").append("<div>Latitude: " + latitude + " | Longitude: " + longitude + " | Distance: " + distance + "</div>");
                    oldLat = latitude;
                    oldLong = longitude;
                    $("#firstLoc").hide();
                    $("#recordLoc").show();
                } else {
                    alert("Geolocation API is not supported in your browser.");
                }

            })

        });
    </script>
</head>

<div>
    <button id="firstLoc">Click me to start</button>
    <button id="recordLoc">Record Location</button>
</div>
<div>
    <p>Below will record your coords and how far since the last time you hit "Record Location"</p>
    <div id=coordsDiv></div>
</div>

</html>